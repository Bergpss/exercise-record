# å¥èº«è®°å½• Web åº”ç”¨ - éœ€æ±‚ä¸è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

ä¸€æ¬¾åŸºäº Web çš„æ¯æ—¥å¥èº«è®°å½•åº”ç”¨ï¼Œå¸®åŠ©ç”¨æˆ·è·Ÿè¸ªå’Œç®¡ç†æ—¥å¸¸è®­ç»ƒæ•°æ®ã€‚åº”ç”¨æä¾›ç›´è§‚çš„å‘¨è§†å›¾å±•ç¤ºè®­ç»ƒå†…å®¹ï¼Œå¹¶é›†æˆ Gemini AI è¿›è¡Œæ™ºèƒ½å‘¨æ€»ç»“åˆ†æã€‚

## 2. æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 2.1 æ¯æ—¥è®­ç»ƒè®°å½•

| æ•°æ®å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| è®­ç»ƒæ—¥æœŸ | Date | è‡ªåŠ¨è®°å½•å½“å¤©æ—¥æœŸ |
| è®­ç»ƒåŠ¨ä½œ | String | å¦‚ï¼šä¿¯å§æ’‘ã€æ·±è¹²ã€å¼•ä½“å‘ä¸Šç­‰ |
| æ•°é‡ | Number | å•ä½ï¼šæ¬¡/ç»„ |
| æ—¶é•¿ | Number | å•ä½ï¼šåˆ†é’Ÿ |
| ä¸ªäººæ„Ÿå— | Text | ç”¨æˆ·å¯¹æœ¬æ¬¡è®­ç»ƒçš„ä¸»è§‚æ„Ÿå—æè¿° |

### 2.2 å‘¨è§†å›¾å±•ç¤º

- **ä¸»è§†å›¾æ¨¡å¼**ï¼šä»¥å‘¨ä¸ºå•ä½å±•ç¤ºè®­ç»ƒæ•°æ®
- **æ—¥æœŸèŒƒå›´**ï¼šå‘¨ä¸€è‡³å‘¨æ—¥ï¼ˆå¯é…ç½®èµ·å§‹æ—¥ï¼‰
- **å¯è§†åŒ–å†…å®¹**ï¼š
  - æ¯æ—¥è®­ç»ƒåŠ¨ä½œåˆ—è¡¨
  - è®­ç»ƒæ—¶é•¿æ±‡æ€»
  - è®­ç»ƒå¼ºåº¦çƒ­åŠ›å›¾ï¼ˆå¯é€‰ï¼‰
  - æœªè®­ç»ƒæ—¥æ ‡è®°

### 2.3 AI å‘¨æ€»ç»“åŠŸèƒ½

**è§¦å‘æ—¶æœº**ï¼šæ¯å‘¨ä¸€ï¼ˆä¸Šå‘¨ç»“æŸåï¼‰

**æŠ€æœ¯å®ç°**ï¼š
- API æ¥å…¥ï¼šGemini API
- æ¨¡å‹ï¼šgemini-3-pro-preview

**æ€»ç»“å†…å®¹**ï¼š
1. **æœ¬å‘¨è®­ç»ƒæ€»æ—¶é•¿**ï¼šç´¯è®¡æ‰€æœ‰è®­ç»ƒæ—¶é—´
2. **åŠ¨ä½œç»Ÿè®¡**ï¼šæ¯ä¸ªåŠ¨ä½œçš„æ€»æ¬¡æ•°/ç»„æ•°
3. **å‘¨å¯¹æ¯”åˆ†æ**ï¼šä¸ä¸Šå‘¨æ•°æ®å¯¹æ¯”ï¼Œåˆ†ææå‡æˆ–é€€æ­¥
4. **æ”¹è¿›å»ºè®®**ï¼šåŸºäºæ•°æ®åˆ†æï¼Œæä¾›ä¸‹å‘¨æ”¹è¿›æ–¹å‘

## 3. æŠ€æœ¯æ¶æ„è®¾è®¡

### 3.1 æŠ€æœ¯æ ˆ

```
å‰ç«¯æ¡†æ¶ï¼šReact + TypeScript
æ ·å¼æ–¹æ¡ˆï¼šVanilla CSSï¼ˆç°ä»£åŒ–è®¾è®¡ï¼‰
æ„å»ºå·¥å…·ï¼šVite
æ•°æ®å­˜å‚¨ï¼šSupabaseï¼ˆPostgreSQL äº‘æ•°æ®åº“ï¼‰
AI é›†æˆï¼šGemini API
```

### 3.2 é¡¹ç›®ç»“æ„

```
exercise-record/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ WeekView/           # å‘¨è§†å›¾ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DayCard/            # æ—¥å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ExerciseForm/       # è®­ç»ƒè®°å½•è¡¨å•
â”‚   â”‚   â”œâ”€â”€ WeeklySummary/      # å‘¨æ€»ç»“å±•ç¤º
â”‚   â”‚   â””â”€â”€ Header/             # é¡µé¢å¤´éƒ¨
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ geminiService.ts    # Gemini API æœåŠ¡
â”‚   â”‚   â””â”€â”€ supabaseService.ts  # Supabase æ•°æ®åº“æœåŠ¡
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ supabase.ts         # Supabase å®¢æˆ·ç«¯é…ç½®
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ dateUtils.ts        # æ—¥æœŸå¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useExerciseData.ts  # æ•°æ®ç®¡ç† Hook
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ App.css
â”‚   â””â”€â”€ main.tsx
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ requirements-zh.md
â”‚   â””â”€â”€ requirements-en.md
â”œâ”€â”€ .env.local                  # ç¯å¢ƒå˜é‡ï¼ˆAPI Keysï¼‰
â””â”€â”€ package.json
```

### 3.3 ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.local
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
VITE_GEMINI_API_KEY=your_gemini_api_key
```

### 3.4 æ•°æ®æ¨¡å‹

```typescript
// å•æ¬¡è®­ç»ƒè®°å½•
interface ExerciseEntry {
  id: string;
  date: string;           // ISO æ—¥æœŸæ ¼å¼ YYYY-MM-DD
  exercise: string;       // åŠ¨ä½œåç§°
  count: number;          // æ•°é‡
  duration: number;       // æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  feeling: string;        // ä¸ªäººæ„Ÿå—
  createdAt: string;      // åˆ›å»ºæ—¶é—´
}

// æ—¥è®­ç»ƒæ±‡æ€»
interface DayRecord {
  date: string;
  entries: ExerciseEntry[];
  totalDuration: number;
}

// å‘¨è®­ç»ƒæ•°æ®
interface WeekData {
  weekStart: string;      // å‘¨èµ·å§‹æ—¥æœŸ
  weekEnd: string;        // å‘¨ç»“æŸæ—¥æœŸ
  days: DayRecord[];
}

// AI å‘¨æ€»ç»“
interface WeeklySummary {
  id: string;
  user_id: string;
  week_start: string;
  total_duration: number;
  exercise_stats: Record<string, number>;  // åŠ¨ä½œ -> æ€»æ¬¡æ•°
  comparison_with_last_week: string;
  improvement_suggestions: string;
  generated_at: string;
  created_at: string;
}
```

### 3.5 Supabase æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- ç”¨æˆ·è¡¨ï¼ˆä½¿ç”¨ Supabase Auth å†…ç½®ï¼‰
-- è®­ç»ƒè®°å½•è¡¨
CREATE TABLE exercise_entries (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  exercise VARCHAR(100) NOT NULL,
  count INTEGER NOT NULL DEFAULT 0,
  duration INTEGER NOT NULL DEFAULT 0,  -- åˆ†é’Ÿ
  feeling TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å‘¨æ€»ç»“è¡¨
CREATE TABLE weekly_summaries (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  week_start DATE NOT NULL,
  total_duration INTEGER NOT NULL DEFAULT 0,
  exercise_stats JSONB,
  comparison_with_last_week TEXT,
  improvement_suggestions TEXT,
  generated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, week_start)
);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)
ALTER TABLE exercise_entries ENABLE ROW LEVEL SECURITY;
ALTER TABLE weekly_summaries ENABLE ROW LEVEL SECURITY;

-- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can manage own entries" ON exercise_entries
  FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Users can manage own summaries" ON weekly_summaries
  FOR ALL USING (auth.uid() = user_id);
```

## 4. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 4.1 ä¸»ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: å¥èº«è®°å½•  |  [â† ä¸Šå‘¨]  æœ¬å‘¨  [ä¸‹å‘¨ â†’]  | [+ æ·»åŠ ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚   å‘¨ä¸€      å‘¨äºŒ      å‘¨ä¸‰      å‘¨å››      å‘¨äº”      å‘¨å…­      å‘¨æ—¥   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚ â”‚
â”‚  â”‚ è®­ç»ƒ â”‚  â”‚ è®­ç»ƒ â”‚  â”‚ä¼‘æ¯æ—¥â”‚  â”‚ è®­ç»ƒ â”‚  â”‚ è®­ç»ƒ â”‚  â”‚ è®­ç»ƒ â”‚  â”‚ä¼‘æ¯æ—¥â”‚ â”‚
â”‚  â”‚ å†…å®¹ â”‚  â”‚ å†…å®¹ â”‚  â”‚     â”‚  â”‚ å†…å®¹ â”‚  â”‚ å†…å®¹ â”‚  â”‚ å†…å®¹ â”‚  â”‚     â”‚ â”‚
â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“Š ç”Ÿæˆå‘¨æ€»ç»“]                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AI å‘¨æ€»ç»“                                         â”‚  â”‚
â”‚  â”‚  æœ¬å‘¨æ€»æ—¶é•¿ï¼š120 åˆ†é’Ÿ                               â”‚  â”‚
â”‚  â”‚  åŠ¨ä½œç»Ÿè®¡ï¼šä¿¯å§æ’‘ 150æ¬¡ï¼Œæ·±è¹² 100æ¬¡...              â”‚  â”‚
â”‚  â”‚  å¯¹æ¯”åˆ†æï¼šç›¸æ¯”ä¸Šå‘¨æå‡ 15%...                      â”‚  â”‚
â”‚  â”‚  æ”¹è¿›å»ºè®®ï¼šå»ºè®®å¢åŠ æ ¸å¿ƒè®­ç»ƒ...                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è®¾è®¡é£æ ¼

- **ä¸»é¢˜è‰²**ï¼šæ´»åŠ›æ©™/å¥åº·ç»¿ æ¸å˜é…è‰²
- **é£æ ¼**ï¼šç°ä»£ç®€æ´ï¼Œå¡ç‰‡å¼è®¾è®¡
- **åŠ¨æ•ˆ**ï¼šæµç•…çš„å¾®äº¤äº’åŠ¨ç”»
- **å“åº”å¼**ï¼šé€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

## 5. API è®¾è®¡

### 5.1 Gemini API è°ƒç”¨

```typescript
// å‘¨æ€»ç»“ Prompt æ¨¡æ¿
const generateWeeklySummaryPrompt = (
  currentWeekData: WeekData,
  lastWeekData: WeekData | null
): string => {
  return `
    è¯·æ ¹æ®ä»¥ä¸‹å¥èº«æ•°æ®ç”Ÿæˆå‘¨æ€»ç»“ï¼š
    
    ã€æœ¬å‘¨è®­ç»ƒæ•°æ®ã€‘
    ${JSON.stringify(currentWeekData)}
    
    ã€ä¸Šå‘¨è®­ç»ƒæ•°æ®ã€‘
    ${lastWeekData ? JSON.stringify(lastWeekData) : 'æ— ä¸Šå‘¨æ•°æ®'}
    
    è¯·ç”ŸæˆåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ€»ç»“ï¼š
    1. æœ¬å‘¨æ€»è®­ç»ƒæ—¶é•¿
    2. æ¯ä¸ªåŠ¨ä½œçš„æ€»æ¬¡æ•°ç»Ÿè®¡
    3. ä¸ä¸Šå‘¨çš„å¯¹æ¯”åˆ†æï¼ˆå¦‚æœ‰ä¸Šå‘¨æ•°æ®ï¼‰
    4. ä¸‹å‘¨æ”¹è¿›å»ºè®®
    
    è¯·ç”¨é¼“åŠ±æ€§çš„è¯­æ°”è¿›è¡Œæ€»ç»“ã€‚
  `;
};
```

## 6. å¼€å‘è®¡åˆ’

### Phase 1ï¼šåŸºç¡€æ¡†æ¶ï¼ˆ1-2å¤©ï¼‰
- [ ] é¡¹ç›®åˆå§‹åŒ–ï¼ˆVite + React + TypeScriptï¼‰
- [ ] åŸºç¡€ç»„ä»¶ç»“æ„æ­å»º
- [ ] æ ·å¼ç³»ç»Ÿå»ºç«‹

### Phase 2ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰
- [ ] å‘¨è§†å›¾ç»„ä»¶å¼€å‘
- [ ] è®­ç»ƒè®°å½•è¡¨å•
- [ ] æœ¬åœ°æ•°æ®å­˜å‚¨

### Phase 3ï¼šAI é›†æˆï¼ˆ1-2å¤©ï¼‰
- [ ] Gemini API æ¥å…¥
- [ ] å‘¨æ€»ç»“ç”ŸæˆåŠŸèƒ½
- [ ] æ€»ç»“ç»“æœå±•ç¤º

### Phase 4ï¼šå®Œå–„ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] UI/UX ä¼˜åŒ–
- [ ] å“åº”å¼é€‚é…
- [ ] æµ‹è¯•ä¸ä¿®å¤

## 7. æœªæ¥æ‰©å±•

- æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/PDFï¼‰
- è®­ç»ƒè®¡åˆ’æ¨¡æ¿
- å†å²æ•°æ®å›¾è¡¨åˆ†æ
- äº‘ç«¯æ•°æ®åŒæ­¥
- ç¤¾äº¤åˆ†äº«åŠŸèƒ½
